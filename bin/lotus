#!/usr/bin/env ruby

require 'bundler'
Bundler.require
require 'active_support/core_ext'
require 'active_record'
require 'yaml'

root = File.expand_path(__dir__ + '/..')
%w{job}.each do |filename|
  require root+'/lib/'+filename
end

%w{sleep}.each do |filename|
  require root+'/jobs/'+filename
end

database_config = YAML.load_file(root+'/config/database.yml').symbolize_keys
ActiveRecord::Base.establish_connection(
  database_config[:development]
)
create_db = lambda do |config|
  ActiveRecord::Base.connection.create_database config['database'], config
  ActiveRecord::Base.establish_connection config
end
create_db.call(database_config[:development])
load root+'/config/schema.rb'

class Lotus < Thor
  desc 'sleep', 'test job'
  def sleep
    SleepJob.new().execute!
  end
end

Lotus.start(ARGV)
