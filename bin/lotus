#!/usr/bin/env ruby

require 'bundler'
Bundler.require
require 'active_support'
require 'active_support/core_ext'
require 'active_record'
require 'yaml'

root = File.expand_path(__dir__ + '/..')
%w{lotus lotus/job}.each do |filename|
  require root+'/lib/'+filename
end

%w{video job job_log}.each do |filename|
  require root+'/models/'+filename
end

%w{sleep create_db update_schema process}.each do |filename|
  require root+'/jobs/'+filename
end

class LotusCLI < Thor
  class_option :env

  desc 'sleep', 'test job'
  def sleep
    SleepJob.new(env).execute!
  end

  desc 'process', 'process'
  def process
    ProcessJob.new(env).execute!
  end

  desc 'process_all', 'process all'
  def process_all
  end

  desc 'create_db', 'create_db'
  def create_db
    CreateDB.new(env).execute!
  end

  desc 'update_schema', 'update schema'
  def update_schema
    UpdateSchema.new(env).execute!
  end

  private
  def env
    options['env'].blank? ? :development : options[:env].to_sym
  end
end

LotusCLI.start(ARGV)
